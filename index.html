<body>
  <div style="width: fit-content">
    <div id="video-container">
      <video controls autoplay id="Video1">
        <source src="./example-video.webm" type="video/webm" />
        Sorry, your browser doesnt support embedded videos
      </video>
    </div>
    <div
      style="display: flex; padding-top: 10px; justify-content: space-around"
    >
      <button onClick="skip(-1)" style="padding: 10px">Rewind -1</button>
      <button onClick="skip(1)" style="padding: 10px">Forward +1</button>
    </div>
    <div
      style="display: flex; padding-top: 10px; justify-content: space-around"
    >
      <button onmousedown="start()" onmouseup="end()">Record</button>
    </div>
  </div>
  <div id="new-videos"></div>
</body>
<script type="text/javascript">
  var video = document.getElementById('Video1');
  let startTime;
  let endTime;
  let videoNumber = 0;
  function skip(value) {
    video.currentTime += value;
  }

  function start() {
    // if already in a paused state, reject!
    console.log('## start (video.currentTime): ', video.currentTime);
    startTime = video.currentTime;
  }
  function end() {
    console.log('## end (video.currentTime): ', video.currentTime);
    endTime = video.currentTime;
    createVideoUI();
    videoNumber = videoNumber += 1;
  }

  function handleVideoChange(evt) {
    let currentTime = evt.target.currentTime;
    const endTime = evt.target.dataset.end;
    const startTime = evt.target.dataset.start;
    const videoId = evt.target.id;
    const thisVideoEl = document.getElementById(videoId);
    const currentTimeIsBeforeStartTime = currentTime < startTime;
    const currentTimeIsAfterEndTime = currentTime > endTime;
    if (currentTimeIsBeforeStartTime) {
      thisVideoEl.pause();
      thisVideoEl.currentTime = startTime;
    } else if (currentTimeIsAfterEndTime) {
      thisVideoEl.pause();
      thisVideoEl.currentTime = endTime;
    }
  }

  function createVideoUI() {
    const newVideoContainer = document.getElementById('new-videos');

    const videoEl = document.createElement('video');
    const sourceEl = document.createElement('source');
    const videoElId = `video-${videoNumber}`;

    videoEl.setAttribute('id', videoElId);
    videoEl.setAttribute('controls', true);
    videoEl.setAttribute('height', '300px');
    videoEl.setAttribute('data-start', startTime);
    videoEl.setAttribute('data-end', endTime);

    newVideoContainer.appendChild(videoEl);

    sourceEl.setAttribute('type', 'video/webm');
    sourceEl.setAttribute('data-start', startTime);
    sourceEl.setAttribute('data-end', endTime);
    sourceEl.setAttribute(
      'src',
      `./example-video.webm#t=${startTime},${endTime}`,
    );
    videoEl.appendChild(sourceEl);
    videoEl.addEventListener('timeupdate', handleVideoChange);
  }
  document.getElementById('video-container').onkeydown = function (e) {
    if (e.key == 'ArrowLeft') {
      skip(-1);
    }
    if (e.key == 'ArrowRight') {
      skip(1);
    }
  };
</script>
