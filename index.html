<body>
  <div style="width: fit-content">
    <div id="video-container">
      <video controls autoplay id="Video1">
        <source src="./example-video.webm" type="video/webm" />
        Sorry, your browser doesnt support embedded videos
      </video>
    </div>
    <div
      style="display: flex; padding-top: 10px; justify-content: space-around"
    >
      <button onClick="skip(-1)" style="padding: 10px">Rewind -1</button>
      <button onClick="skip(1)" style="padding: 10px">Forward +1</button>
    </div>
    <div
      style="display: flex; padding-top: 10px; justify-content: space-around"
    >
      <button onmousedown="start()" onmouseup="end()">Record</button>
    </div>
  </div>
  <div id="new-videos"></div>
</body>
<script type="text/javascript">
  var video = document.getElementById('Video1');
  let startTime;
  let endTime;
  let videoNumber = 0;
  function skip(value) {
    video.currentTime += value;
  }

  function start() {
    // if already in a paused state, reject!
    startTime = video.currentTime;
  }
  function end() {
    endTime = video.currentTime;
    createVideoUI();
    videoNumber = videoNumber += 1;
  }

  function handleVideoChange(evt) {
    let currentTime = evt.target.currentTime;
    const endTime = evt.target.dataset.end;
    const startTime = evt.target.dataset.start;
    const videoId = evt.target.id;
    const thisVideoEl = document.getElementById(videoId);
    const currentTimeIsBeforeStartTime = currentTime < startTime;
    const currentTimeIsAfterEndTime = currentTime > endTime;
    if (currentTimeIsBeforeStartTime) {
      thisVideoEl.pause();
      thisVideoEl.currentTime = startTime;
    } else if (currentTimeIsAfterEndTime) {
      thisVideoEl.pause();
      thisVideoEl.currentTime = endTime;
    }
  }

  function createInput(videoElId, startTime, endTime) {
    // const startInputContainer = document.createElement('div');
    // const endInputContainer = document.createElement('div');

    const startInput = document.createElement('input');
    const endInput = document.createElement('input');
    const inputContainer = document.createElement('div');

    startInput.setAttribute('type', 'text');
    endInput.setAttribute('type', 'text');

    startInput.setAttribute('id', `start-input-${videoElId}`);
    endInput.setAttribute('id', `end-input-${videoElId}`);

    startInput.setAttribute('disabled', true);
    endInput.setAttribute('disabled', true);

    startInput.setAttribute('value', startTime);
    endInput.setAttribute('value', endTime);

    return {
      inputContainer,
      startInput,
      endInput,
    };
  }

  function toggleStartTime(evt) {
    const videoId = evt.target.dataset.videoid;
    const thisVideoEl = document.getElementById(videoId);
    const thisStartInput = document.getElementById(`start-input-${videoId}`);
    thisVideoEl.pause();
    const startTime = thisVideoEl.dataset.start;
    thisVideoEl.dataset.start = startTime - 0.5;
    thisStartInput.value = startTime - 0.5;
    thisVideoEl.currentTime = startTime - 0.5;
  }

  function addStartEndTimeAdjusters(
    startInput,
    endInput,
    inputContainer,
    videoElId,
  ) {
    const startBtn = document.createElement('button');
    startBtn.innerText = 'toggle by -0.5'; // assume it is even possible
    startBtn.setAttribute('data-videoId', videoElId);
    inputContainer.appendChild(startBtn);
    startBtn.addEventListener('click', toggleStartTime);
  }

  function createVideoUI() {
    const newVideoContainer = document.getElementById('new-videos');
    newVideoContainer.style.textAlign = 'center';

    const videoEl = document.createElement('video');
    const sourceEl = document.createElement('source');
    const videoElId = `video-${videoNumber}`;

    const { inputContainer, startInput, endInput } = createInput(
      videoElId,
      startTime,
      endTime,
    );

    videoEl.setAttribute('id', videoElId);
    videoEl.setAttribute('controls', true);
    videoEl.setAttribute('height', '300px');
    videoEl.setAttribute('data-start', startTime);
    videoEl.setAttribute('data-end', endTime);

    newVideoContainer.appendChild(videoEl);
    newVideoContainer.appendChild(inputContainer);

    inputContainer.appendChild(startInput);
    inputContainer.appendChild(endInput);

    addStartEndTimeAdjusters(startInput, endInput, inputContainer, videoElId);

    sourceEl.setAttribute('type', 'video/webm');
    sourceEl.setAttribute('data-start', startTime);
    sourceEl.setAttribute('data-end', endTime);
    sourceEl.setAttribute(
      'src',
      `./example-video.webm#t=${startTime},${endTime}`,
    );
    videoEl.appendChild(sourceEl);
    videoEl.addEventListener('timeupdate', handleVideoChange);
  }
  document.getElementById('video-container').onkeydown = function (e) {
    if (e.key == 'ArrowLeft') {
      skip(-1);
    }
    if (e.key == 'ArrowRight') {
      skip(1);
    }
  };
</script>
